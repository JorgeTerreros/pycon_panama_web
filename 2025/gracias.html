<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Gracias | PyCon Panamá 2025</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta name="description" content="Gracias por registrarte en PyCon Panamá 2025.">
  <link href="img/pycon25.png" rel="icon">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/style.min.css" rel="stylesheet">
  <link href="css/theme-2025.css" rel="stylesheet">

  <!-- CSP rápida (mejor servida por encabezado HTTP en producción) -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data:;
    connect-src 'self';
    frame-ancestors 'none';
    base-uri 'self'">
</head>
<body>
  <div data-include="header"></div>

  <main class="container py-5" role="main">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <section class="section-muted p-4 p-md-5 rounded text-center" id="thanks-section">
          <h1 class="mb-3">¡Gracias por registrarte!</h1>
          <p class="lead mb-3">Hemos recibido tu registro para PyCon Panamá 2025.</p>

          <!-- Contenedor donde mostraremos datos -->
          <div id="reg-info" class="mt-3" aria-live="polite"></div>

          <p class="mb-4">Te enviaremos novedades de la agenda y la confirmación de tu inscripción pronto.
            Si tienes preguntas, escríbenos a
            <a href="mailto:pyconpanama@gmail.com">pyconpanama@gmail.com</a>.
          </p>

          <a class="btn btn-primary" href="/2025/">Volver al inicio</a>
        </section>
      </div>
    </div>
  </main>

  <div data-include="footer"></div>

  <script defer src="js/components/include.js"></script>
  <div data-include="scripts"></div>

  <script>
  (function () {
    const infoWrap = document.getElementById('reg-info');
    if (!infoWrap) return;

    // Elementos a inyectar de forma segura
    function addLine(label, value) {
      if (!value) return;
      const p = document.createElement('p');
      p.className = 'mb-1';
      const strong = document.createElement('strong');
      strong.textContent = label + ': ';
      const span = document.createElement('span');
      span.textContent = value; // <- textContent: sin HTML
      p.appendChild(strong);
      p.appendChild(span);
      infoWrap.appendChild(p);
    }

    try {
      // Código no es PII: se guardó en localStorage en el form
      const code = localStorage.getItem('pc25_last_code') || '';

      // PII: usar sessionStorage y limpiar después
      const name = sessionStorage.getItem('pc25_last_name') || '';
      const email = sessionStorage.getItem('pc25_last_email') || '';

      if (code || name || email) {
        addLine('Código de registro', code);
        addLine('Nombre', name);
        addLine('Email', email);

        // Borra PII del almacenamiento de sesión apenas se muestra
        sessionStorage.removeItem('pc25_last_name');
        sessionStorage.removeItem('pc25_last_email');
      } else {
        // Fallback: acceso directo a la página
        const p = document.createElement('p');
        p.className = 'text-muted';
        p.textContent = 'Si acabas de registrarte, tu código aparecerá aquí. ' +
                        'Si no lo ves, regresa al formulario y vuelve a enviar.';
        infoWrap.appendChild(p);
      }
    } catch (e) {
      const p = document.createElement('p');
      p.className = 'text-muted';
      p.textContent = 'No pudimos mostrar el detalle del registro en este navegador.';
      infoWrap.appendChild(p);
    }
  })();
  </script>
</body>
</html>
